<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NCube.js</title>
</head>
<body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/svg.js/3.1.1/svg.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="ncube.js"></script>
    <script>
        // Set up our Three.js environment and create our line material
        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(75, 200 / 200, 0.1, 1000);
        const material = new THREE.LineBasicMaterial({ color: "#4287f5" });
        const renderer = new THREE.WebGLRenderer({ alpha: true }); 
        scene.rotateX(-Math.PI / 2), camera.position.z = 1;
        renderer.setClearColor(0x000000, 0), renderer.setSize(300, 300);
        document.body.appendChild(renderer.domElement);

        // Create an array to store our edge geometries
        const edges = [];

        // Create a 4-dimensional hypercube
        const nCube = new NCube(4, [-1, 1], {
            renderEdges: function() {
                // Render each edge
                this.edges.forEach((edge, i) => {
                    // Create new geometry with the 3-dimensional projections of the verticies in the edge
                    const geometry = new THREE.BufferGeometry().setFromPoints(
                        edge.map(vertex => new THREE.Vector3(...vertex.project(3, 4)))
                    );

                    // Either add a new line to the edge geometry array or update the existing geometry
                    if (edges[i]) {
                        edges[i].geometry.dispose();
                        edges[i].geometry = geometry;
                    } else {
                        const line = new THREE.Line(geometry, material);
                        edges.push(line);
                        scene.add(line);
                    }
                });
            }
        });

        let angle = 0;
        const render = () => {
            if (angle < 630) {
                requestAnimationFrame(render);
            }

            // Each frame, reset and rotate the hypercube on the ZW and XY planes, then render its edges
            nCube.reset().rotate(angle/100, [0, 2]).renderEdges();
            
            // Restart the rotation when angle = 630
            angle = angle === 629 ? 0 : angle + 2;
            renderer.render(scene, camera);
        };
    </script>
</body>
</html>